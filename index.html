<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal da Ordem | Acervo Digital</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        // üîÆ CONFIGURA√á√ÉO VISUAL DA ORDEM üîÆ
        const CURRENT_THEME = 'Mabon'; 

        const THEMES = {
            'Yule': { name: 'Yule', primary: { 400: '#D4AF37', 500: '#C5A028', 900: '#3D3008' }, accent: '#8B0000', particle: '‚ùÑ' },
            'Imbolc': { name: 'Imbolc', primary: { 400: '#A5F2F3', 500: '#7CD1D3', 900: '#1A4D4F' }, accent: '#FFFFFF', particle: '‚ú®' },
            'Ostara': { name: 'Ostara', primary: { 400: '#90EE90', 500: '#77DD77', 900: '#1A4F1A' }, accent: '#FFB7C5', particle: 'üå∏' },
            'Beltane': { name: 'Beltane', primary: { 400: '#FF2400', 500: '#DD2400', 900: '#4F0A00' }, accent: '#50C878', particle: 'üî•' },
            'Litha': { name: 'Litha', primary: { 400: '#FFD700', 500: '#FFC000', 900: '#5C4800' }, accent: '#FFA500', particle: '‚òÄÔ∏è' },
            'Lammas': { name: 'Lammas', primary: { 400: '#F4C430', 500: '#DAA520', 900: '#5C4000' }, accent: '#D2691E', particle: 'üåæ' },
            'Mabon': { name: 'Mabon', primary: { 400: '#D2691E', 500: '#8B4513', 900: '#3D1F00' }, accent: '#A0522D', particle: 'üçÇ' }, 
            'Samhain': { name: 'Samhain', primary: { 400: '#9370DB', 500: '#8A2BE2', 900: '#2E004F' }, accent: '#FF4500', particle: 'üïØÔ∏è' }
        };

        const activeTheme = THEMES[CURRENT_THEME];

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        void: '#050505',
                        primary: activeTheme.primary,
                        obsidian: '#0f0f10',
                        accent: activeTheme.accent,
                    },
                    fontFamily: {
                        display: ['Cinzel', 'serif'],
                        body: ['Lato', 'sans-serif'],
                    },
                    animation: { 'bounce-slow': 'bounce 3s infinite' }
                }
            }
        }
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700;900&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        /* ESTILOS GERAIS */
        body { background-color: #050505; color: #e5e5e5; overflow-x: hidden; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(to bottom, var(--accent-color, #8B0000), var(--primary-color, #D4AF37)); border-radius: 3px; }

        .glass-dark {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .text-gradient-theme {
            background: linear-gradient(to right, var(--primary-dark), var(--primary-light), var(--primary-main));
            -webkit-background-clip: text; background-clip: text; color: transparent; background-size: 200% auto; animation: shine 5s linear infinite;
        }
        @keyframes shine { to { background-position: 200% center; } }
        
        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        
        .input-luxe { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); color: #fff; transition: 0.3s; }
        .input-luxe:focus { outline: none; border-color: var(--primary-main); background: rgba(255, 255, 255, 0.05); }

        .particle-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; overflow: hidden; }
        .particle {
            position: absolute; opacity: 0;
            animation: particleAnim linear infinite;
        }
        @keyframes particleAnim {
            0% { opacity: 0; transform: translateY(0) rotate(0deg); }
            20% { opacity: 0.5; }
            100% { opacity: 0; transform: translateY(-100vh) rotate(360deg); }
        }

        .project-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative; overflow: hidden;
        }
        .project-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-main);
            box-shadow: 0 10px 40px -10px rgba(255, 255, 255, 0.1), 0 0 20px var(--accent-color-alpha);
        }

        .path-container-wrapper {
            position: relative; width: 100%; overflow-x: hidden; min-height: 600px;
            display: flex; justify-content: center; padding-top: 40px; padding-bottom: 100px;
        }
        .path-svg-line { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
        .path-node-wrapper { position: absolute; transform: translate(-50%, -50%); z-index: 2; display: flex; flex-direction: column; align-items: center; }
        
        .game-node {
            width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; cursor: pointer; position: relative; transition: transform 0.2s;
            box-shadow: 0 6px 0 rgba(0,0,0,0.5); 
        }
        .game-node:active { transform: translateY(4px); box-shadow: 0 2px 0 rgba(0,0,0,0.5); }

        .game-node.status-completed {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-main));
            border: 4px solid #FFD700; color: #000; box-shadow: 0 6px 0 #b8860b, 0 0 20px var(--primary-main);
        }
        .game-node.status-active {
            background: var(--accent-color); border: 4px solid #fff; color: #fff;
            box-shadow: 0 6px 0 #500000, 0 0 30px var(--accent-color); animation: pulseActive 2s infinite;
        }
        @keyframes pulseActive {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(255, 255, 255, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }
        .game-node.status-locked {
            background: #1a1a1a; border: 4px solid #333; color: #444; cursor: not-allowed; box-shadow: 0 6px 0 #000;
        }

        .node-label {
            position: absolute; top: 85px; background: #fff; color: #000; padding: 5px 10px; border-radius: 8px;
            font-family: 'Lato', sans-serif; font-weight: bold; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); opacity: 0; transform: translateY(-10px); transition: 0.3s; pointer-events: none;
            text-align: center; min-width: 120px; max-width: 180px; left: 50%; transform: translateX(-50%); z-index: 10;
        }
        .path-node-wrapper:hover .node-label { opacity: 1; transform: translateX(-50%) translateY(0); }
        
        .video-wrapper {
            position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;
            background: #000; border: 1px solid var(--primary-dark); box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

    </style>
</head>
<body class="antialiased">

    <div class="particle-container" id="particles"></div>
    <script>
        const root = document.documentElement;
        root.style.setProperty('--primary-main', activeTheme.primary[400]);
        root.style.setProperty('--primary-light', activeTheme.primary[500]);
        root.style.setProperty('--primary-dark', activeTheme.primary[900]);
        root.style.setProperty('--accent-color', activeTheme.accent);

        const pContainer = document.getElementById('particles');
        for (let i = 0; i < 30; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.innerHTML = activeTheme.particle;
            p.style.left = Math.random() * 100 + '%';
            p.style.top = Math.random() * 100 + '%';
            p.style.animationDuration = Math.random() * 10 + 5 + 's';
            p.style.animationDelay = Math.random() * 5 + 's';
            p.style.fontSize = Math.random() * 10 + 5 + 'px';
            p.style.color = Math.random() > 0.8 ? activeTheme.primary[400] : '#fff';
            pContainer.appendChild(p);
        }
    </script>

    <div id="app-root">
        
        <div id="loading-spinner" class="fixed inset-0 bg-black/95 z-50 flex flex-col items-center justify-center hidden">
            <div class="relative animate-bounce mb-4">
                <i class="fas fa-eye text-4xl text-primary-400"></i>
                <i class="fas fa-circle-notch absolute -top-2 -right-2 text-accent text-sm animate-spin"></i>
            </div>
            <p class="text-primary-400 text-xs tracking-[0.3em] uppercase animate-pulse">Acessando Arquivos da Ordem...</p>
        </div>

        <!-- HEADER -->
        <header class="fixed top-0 w-full z-40 bg-void/90 backdrop-blur border-b border-primary-900/30 h-20 transition-all duration-300">
            <div class="container mx-auto px-6 h-full flex justify-between items-center">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="showView('home-view')">
                    <div class="h-10 w-10 bg-primary-900/20 rounded-full flex items-center justify-center border border-primary-500/30 group-hover:border-primary-400 transition">
                        <i class="fas fa-book-open text-primary-400 text-lg"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-primary-400 uppercase tracking-[0.3em]">Portal da</span>
                        <h1 class="text-lg font-display text-white tracking-widest group-hover:text-primary-400 transition">ORDEM</h1>
                    </div>
                </div>

                <nav class="hidden md:flex items-center space-x-8">
                    <button data-view="home-view" class="internal-link text-xs font-display font-bold tracking-[0.2em] text-gray-400 hover:text-white uppercase transition">In√≠cio</button>
                    <button data-view="blog-view" class="internal-link text-xs font-display font-bold tracking-[0.2em] text-gray-400 hover:text-white uppercase transition">Videoteca</button>
                    
                    <div class="w-[1px] h-4 bg-white/10"></div>
                    
                    <div id="user-info" class="hidden items-center gap-3">
                        <button onclick="showView('profile-view')" class="flex items-center gap-2 text-gray-400 hover:text-primary-400 transition group">
                            <i id="header-user-icon" class="fas fa-user-circle"></i>
                            <span id="header-user-name" class="text-[10px] hidden sm:inline uppercase tracking-widest group-hover:underline">Iniciado</span>
                        </button>
                        <div class="w-[1px] h-3 bg-white/10 mx-1"></div>
                        <button id="logout-btn" class="text-gray-400 hover:text-red-500 text-xs" title="Sair"><i class="fas fa-power-off"></i></button>
                    </div>
                    <button id="login-btn" class="hidden text-xs font-display text-primary-400 uppercase tracking-widest hover:text-white border-b border-transparent hover:border-primary-400 pb-1">Login</button>
                </nav>
            </div>
        </header>

        <main class="pt-20 min-h-screen relative z-10">
            
            <!-- HOME VIEW -->
            <div id="home-view" class="view-container">
                <section class="relative min-h-[85vh] flex flex-col items-center justify-center text-center px-4 overflow-hidden">
                    <div class="absolute inset-0 z-0 opacity-30 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-accent/20 via-obsidian to-black"></div>
                    
                    <div class="relative z-10 max-w-4xl mx-auto space-y-6">
                        <div class="flex justify-center mb-4 relative">
                            <i class="fas fa-compass text-2xl text-primary-500 animate-spin-slow opacity-50"></i>
                        </div>
                        <h2 class="text-primary-500 text-xs md:text-sm tracking-[0.6em] uppercase fade-in-up">
                            Conhecimento Oculto
                        </h2>
                        <h1 class="text-5xl md:text-7xl lg:text-8xl font-display font-black text-white leading-tight fade-in-up" style="animation-delay: 0.2s">
                            A ORDEM DO <br><span class="text-gradient-theme">CONHECIMENTO</span>
                        </h1>
                        <p class="text-gray-300 max-w-2xl mx-auto text-lg font-body font-light leading-relaxed fade-in-up" style="animation-delay: 0.4s">
                            Bem-vindo ao acervo de aulas. Aqui, a teoria encontra a pr√°tica atrav√©s dos nossos registros visuais.
                        </p>
                        <div class="pt-8 fade-in-up" style="animation-delay: 0.6s">
                            <button data-view="blog-view" class="internal-link px-10 py-4 bg-transparent border border-primary-400 text-primary-400 font-display text-sm font-bold tracking-[0.2em] uppercase hover:bg-primary-900/50 hover:text-white transition shadow-[0_0_20px_rgba(255,255,255,0.1)]">
                                Acessar Videoteca
                            </button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- ACERVO / BLOG VIEW -->
            <div id="blog-view" class="view-container hidden max-w-7xl mx-auto pt-10 px-4">
                
                <!-- PAINEL ADMIN -->
                <div id="admin-panel" class="hidden mb-16 p-8 bg-obsidian border border-primary-900/30 rounded-sm relative overflow-hidden">
                    <div class="absolute -right-10 -top-10 text-9xl text-white/5 pointer-events-none"><i class="fas fa-video"></i></div>
                    <h3 class="text-primary-400 font-display text-xl mb-6 flex items-center gap-2 relative z-10"><i class="fas fa-cog"></i> Painel do Instrutor</h3>
                    
                    <div class="grid lg:grid-cols-2 gap-10 relative z-10">
                        <form id="create-post-form" class="space-y-4">
                            <h4 class="text-gray-400 text-xs uppercase tracking-widest"><i class="fas fa-plus-circle mr-2"></i>Nova Aula</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <input type="text" id="post-title" class="input-luxe w-full p-3 font-display text-lg" placeholder="T√≠tulo da Aula" required>
                                <input type="text" id="post-subtitle" class="input-luxe w-full p-3 font-body text-sm" placeholder="Subt√≠tulo / Tema" required>
                            </div>
                            
                            <div class="p-4 bg-black/40 border border-white/5 space-y-3">
                                <p class="text-[10px] text-primary-400 uppercase tracking-widest"><i class="fab fa-google-drive mr-1"></i> Integra√ß√£o Drive</p>
                                <input type="url" id="post-video-link" class="input-luxe w-full p-3 font-body text-sm" placeholder="Link do V√çDEO (Google Drive)" required>
                                <input type="url" id="post-pdf-link" class="input-luxe w-full p-3 font-body text-sm" placeholder="Link do PDF (Google Drive)" required>
                            </div>

                            <textarea id="post-content" rows="3" class="input-luxe w-full p-3 font-body text-sm" placeholder="Breve descri√ß√£o da aula..."></textarea>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <select id="post-access" class="input-luxe w-full p-2 text-sm bg-black cursor-pointer"><option value="aberto">üîì Aberta</option><option value="pago">üîê Membros</option></select>
                                <select id="post-section" class="input-luxe w-full p-2 text-sm bg-black cursor-pointer" required><option value="">Carregando Trilhas...</option></select>
                            </div>

                            <button type="submit" class="w-full bg-primary-900/40 border border-primary-500/50 text-primary-400 py-3 font-bold uppercase text-xs tracking-widest hover:bg-primary-500 hover:text-black transition">Publicar Aula</button>
                            <p id="post-status" class="text-center text-xs h-4 text-primary-500"></p>
                        </form>

                        <div class="space-y-6">
                            <!-- Gest√£o de Alunos -->
                            <div class="bg-black/40 p-5 border border-white/5 flex flex-col h-full">
                                <h4 class="text-gray-400 text-xs uppercase tracking-widest mb-4 flex items-center justify-between">
                                    <span><i class="fas fa-users mr-2"></i>Gest√£o de Alunos</span>
                                    <span id="student-count" class="bg-primary-900/50 text-primary-400 px-2 py-1 rounded text-[10px]">0</span>
                                </h4>
                                
                                <form id="create-account-form" class="flex flex-col gap-2 mb-6 border-b border-white/5 pb-6">
                                    <input type="email" id="new-email" placeholder="Email do Aluno" class="input-luxe p-2 text-sm" required>
                                    <input type="password" id="new-password" placeholder="Senha Provis√≥ria" class="input-luxe p-2 text-sm" required>
                                    <button type="submit" id="create-student-btn" class="border border-primary-900 text-primary-400 py-2 text-xs uppercase hover:bg-primary-900 hover:text-white transition font-bold">Cadastrar Aluno</button>
                                    <p id="account-status" class="text-xs h-4 text-center"></p>
                                </form>

                                <div class="flex-1 overflow-y-auto custom-scrollbar max-h-[300px]">
                                    <div id="students-list-container" class="space-y-2">
                                        <!-- Lista de alunos aqui -->
                                        <p class="text-center text-gray-600 text-xs italic py-4">Carregando lista de iniciados...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Gest√£o de M√≥dulos (Menor) -->
                            <div class="bg-black/40 p-4 border border-white/5">
                                <h4 class="text-gray-400 text-xs uppercase tracking-widest mb-3">M√≥dulos de Estudo</h4>
                                <form id="create-section-form" class="flex gap-2 mb-2">
                                    <input type="text" id="section-name" placeholder="Nome do M√≥dulo" class="input-luxe w-full p-1 text-xs">
                                    <button type="submit" class="text-primary-400 hover:text-white"><i class="fas fa-plus"></i></button>
                                </form>
                                <div id="sections-list-admin" class="max-h-24 overflow-y-auto text-xs text-gray-500 custom-scrollbar"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- HUB DE SE√á√ïES -->
                <div id="sections-hub" class="mb-20">
                    <div class="text-center mb-12 space-y-4">
                        <i class="fas fa-film text-primary-500 text-2xl"></i>
                        <h3 class="text-4xl font-display text-white">Videoteca da Ordem</h3>
                        <p class="text-gray-500 text-sm uppercase tracking-widest">Escolha a trilha de estudos</p>
                    </div>
                    <div id="sections-cards-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <div class="col-span-full text-center py-20">
                            <i class="fas fa-circle-notch fa-spin text-primary-900 text-4xl"></i>
                        </div>
                    </div>
                </div>

                <!-- TRILHA / PATH VIEW -->
                <div id="active-path-view" class="hidden mb-20 relative">
                    <button id="back-to-hub-btn" class="fixed top-24 left-4 z-30 text-gray-500 hover:text-primary-400 text-xs uppercase tracking-widest flex items-center gap-2 transition bg-black/50 p-2 rounded backdrop-blur border border-white/10">
                        <i class="fas fa-arrow-left"></i> Voltar √†s Trilhas
                    </button>

                    <div class="text-center mb-16 pt-8 relative z-10">
                        <h2 id="path-title" class="text-3xl font-display text-white mb-2"></h2>
                        <span class="text-primary-500 text-[10px] uppercase tracking-[0.3em]">Jornada de Aprendizado</span>
                    </div>

                    <div class="relative w-full md:max-w-3xl max-w-md mx-auto min-h-[600px] px-4 pb-20">
                        <div id="path-steps-container" class="path-container-wrapper"></div>
                        <p id="empty-path-msg" class="hidden text-center text-gray-600 text-sm italic mt-10">Nenhuma aula encontrada nesta trilha.</p>
                    </div>
                </div>
            </div>

            <!-- PERFIL -->
            <div id="profile-view" class="view-container hidden max-w-2xl mx-auto pt-10 px-4">
                 <div class="bg-obsidian border border-primary-900/30 p-8 relative overflow-hidden shadow-2xl">
                     <h2 class="text-2xl font-display text-white mb-6">Carteira da Ordem</h2>
                     <p id="profile-email-display" class="text-gray-400 mb-4"></p>
                     <p id="profile-admin-badge" class="hidden text-xs text-primary-400 uppercase tracking-widest mb-4"><i class="fas fa-crown"></i> Alta Sacerdotisa (Admin)</p>
                     <p class="text-xs text-gray-500">Seu progresso √© salvo automaticamente.</p>
                 </div>
            </div>

        </main>

        <!-- MODAL DE LOGIN -->
        <div id="login-view" class="view-container hidden fixed inset-0 z-50 bg-black/95 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="w-full max-w-sm relative bg-obsidian p-10 border border-primary-900/30">
                <button id="close-login-btn" class="absolute top-4 right-4 text-gray-500 hover:text-white transition"><i class="fas fa-times"></i></button>
                <div class="text-center mb-10">
                    <h2 id="login-title" class="text-2xl font-display text-white tracking-widest">ACESSO</h2>
                    <p id="login-subtitle" class="text-[10px] text-gray-500 uppercase tracking-widest mt-2">√Årea de Membros</p>
                </div>
                
                <form id="login-form" class="space-y-6">
                    <input type="email" id="login-email" placeholder="EMAIL" class="w-full bg-transparent border-b border-gray-700 p-3 text-center text-white outline-none font-display">
                    <input type="password" id="login-password" placeholder="SENHA" class="w-full bg-transparent border-b border-gray-700 p-3 text-center text-white outline-none font-display">
                    <button type="submit" id="login-submit-btn" class="w-full border border-primary-900 text-primary-400 py-4 uppercase text-xs tracking-[0.3em] hover:bg-primary-900/20 transition font-bold mt-4">Entrar</button>
                </form>

                <div class="text-center mt-6 pt-6 border-t border-white/5">
                    <button id="toggle-register-btn" class="text-gray-500 text-[10px] uppercase tracking-widest hover:text-white transition">Primeiro Acesso? Criar Conta</button>
                </div>

                <p id="login-error" class="text-center text-red-500 text-xs mt-6 font-display tracking-wider"></p>
            </div>
        </div>

        <!-- PLAYER DE V√çDEO (AULA) -->
        <div id="post-view" class="view-container hidden fixed inset-0 z-[60] bg-[#050505] overflow-y-auto custom-scrollbar">
            <div class="max-w-5xl mx-auto min-h-screen bg-obsidian border-x border-white/5 relative shadow-2xl">
                <!-- Top Bar -->
                <div class="sticky top-0 z-20 bg-obsidian/95 backdrop-blur border-b border-white/5 p-4 flex justify-between items-center h-16 shadow-lg">
                    <button id="back-to-posts-btn" class="text-primary-400 text-xs uppercase tracking-[0.2em] hover:text-white transition flex items-center gap-2 group">
                        <i class="fas fa-arrow-left group-hover:-translate-x-1 transition"></i> Voltar √† Trilha
                    </button>
                    <div class="admin-only-controls hidden gap-4">
                        <button id="post-view-delete-btn" class="text-gray-500 hover:text-red-500 transition"><i class="fas fa-trash"></i> Excluir Aula</button>
                    </div>
                </div>

                <div class="p-0">
                    <!-- √ÅREA DO V√çDEO -->
                    <div class="w-full bg-black border-b border-primary-900/30">
                        <div class="max-w-4xl mx-auto video-wrapper">
                            <iframe id="video-iframe" src="" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
                        </div>
                    </div>

                    <div class="p-6 md:p-12 pb-32">
                        <!-- T√çTULO E DOWNLOAD -->
                        <div class="flex flex-col md:flex-row justify-between items-start gap-8 mb-8 border-b border-white/5 pb-8">
                            <div class="flex-1">
                                <span class="text-primary-500 text-[10px] uppercase tracking-widest font-bold mb-2 block">Aula em Reprodu√ß√£o</span>
                                <h1 id="post-view-title" class="text-3xl font-display text-white mb-2 leading-tight"></h1>
                                <h3 id="post-view-subtitle" class="text-lg text-gray-400 font-light italic"></h3>
                            </div>
                            
                            <a id="post-view-pdf-btn" href="#" target="_blank" class="shrink-0 bg-primary-900 hover:bg-primary-500 hover:text-black text-white px-6 py-4 rounded font-display font-bold uppercase tracking-widest text-xs flex items-center gap-3 transition shadow-[0_0_15px_rgba(212,175,55,0.2)]">
                                <i class="fas fa-file-pdf text-lg"></i> <span>Baixar Material</span>
                            </a>
                        </div>

                        <!-- DESCRI√á√ÉO -->
                        <div class="mb-12">
                            <h4 class="text-gray-500 text-xs uppercase tracking-widest mb-4">Sobre esta aula</h4>
                            <div id="post-view-content" class="prose prose-invert max-w-none text-gray-300 font-body leading-relaxed text-sm"></div>
                        </div>

                        <!-- BOT√ÉO CONCLUIR -->
                        <div class="flex justify-center mb-16">
                            <button id="mark-complete-btn" class="bg-transparent border border-primary-500 text-primary-400 hover:bg-primary-500 hover:text-black px-10 py-3 rounded-full font-display font-bold uppercase tracking-widest text-xs transition transform hover:scale-105 flex items-center gap-3">
                                <i class="fas fa-check-circle text-lg"></i> Marcar Aula como Conclu√≠da
                            </button>
                        </div>
                        
                        <!-- COMENT√ÅRIOS -->
                        <div id="comments-section" class="border-t border-primary-900/20 pt-10">
                             <h3 class="text-xl font-display text-white mb-6"><i class="fas fa-comments text-primary-500 mr-2"></i> D√∫vidas & Coment√°rios</h3>
                             
                             <div id="comments-list" class="space-y-4 mb-8"></div>
                             
                             <div id="comment-form-container" class="hidden bg-black/30 p-4 border border-white/5 rounded">
                                 <textarea id="comment-input" class="input-luxe w-full p-3 text-sm mb-2 bg-obsidian" rows="2" placeholder="Deixe sua d√∫vida sobre a aula..."></textarea>
                                 <button id="submit-comment-btn" class="text-primary-400 text-xs uppercase tracking-widest hover:text-white transition font-bold">Enviar</button>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- FIREBASE MODULE -->
    <script type="module">
        import { initializeApp, deleteApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, getDoc, setDoc, query, deleteDoc, updateDoc, orderBy, increment, where, arrayUnion } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyDBIIcYpc0UGYOEYUMziqRbRFCKwwFKHWo",
          authDomain: "black-f70c1.firebaseapp.com",
          projectId: "black-f70c1",
          storageBucket: "black-f70c1.firebasestorage.app",
          messagingSenderId: "405843705668",
          appId: "1:405843705668:web:7a6ab1a8bdb2016aaf2111"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // üö® IMPORTANTE: COLE SEU UID AQUI DEPOIS DE CRIAR A CONTA üö®
        const ADMIN_UID = "evIzUpBrvAdBTsGlD07vxNocgtv2"; 

        // STATE
        let currentUser = null;
        let currentUserPermissions = [];
        let completedPosts = [];
        let allPosts = [];
        let allSections = [];
        let activeSectionId = null;
        let currentPostId = null;
        let commentsUnsubscribe = null;
        let isRegisterMode = false;
        let studentsUnsubscribe = null; // Para ouvir a lista de alunos

        // UI REFS
        const loadingSpinner = document.getElementById('loading-spinner');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const userInfo = document.getElementById('user-info');
        const adminPanel = document.getElementById('admin-panel');
        const sectionsHub = document.getElementById('sections-hub');
        const activePathView = document.getElementById('active-path-view');

        // === NAV ===
        window.showView = function(viewId) {
            ['home-view', 'blog-view', 'profile-view', 'post-view', 'login-view'].forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    if(id === 'post-view' || id === 'login-view') el.style.display = 'none'; 
                    else el.style.display = (id === viewId) ? 'block' : 'none';
                }
            });

            if(viewId === 'login-view') {
                document.getElementById('login-view').style.display = 'flex';
                resetLoginForm();
            }
            if(viewId === 'post-view') document.getElementById('post-view').style.display = 'block';

            if(viewId === 'blog-view') {
                if(!activeSectionId) {
                    sectionsHub.classList.remove('hidden');
                    activePathView.classList.add('hidden');
                } else {
                    sectionsHub.classList.add('hidden');
                    activePathView.classList.remove('hidden');
                    renderPath(activeSectionId);
                }
            }
            window.scrollTo(0,0);
        };

        document.querySelectorAll('.internal-link').forEach(btn => {
            btn.addEventListener('click', (e) => showView(e.currentTarget.dataset.view));
        });

        // === AUTH & LOGIN/REGISTER TOGGLE ===
        const toggleRegBtn = document.getElementById('toggle-register-btn');
        const loginTitle = document.getElementById('login-title');
        const loginSubtitle = document.getElementById('login-subtitle');
        const loginSubmitBtn = document.getElementById('login-submit-btn');

        function resetLoginForm() {
            isRegisterMode = false;
            updateLoginUI();
            document.getElementById('login-form').reset();
            document.getElementById('login-error').textContent = "";
        }

        function updateLoginUI() {
            if (isRegisterMode) {
                loginTitle.textContent = "REGISTRO";
                loginSubtitle.textContent = "Junte-se √† Ordem";
                loginSubmitBtn.textContent = "Criar Conta";
                toggleRegBtn.textContent = "J√° tem conta? Entrar";
            } else {
                loginTitle.textContent = "ACESSO";
                loginSubtitle.textContent = "√Årea de Membros";
                loginSubmitBtn.textContent = "Entrar";
                toggleRegBtn.textContent = "Primeiro Acesso? Criar Conta";
            }
        }

        toggleRegBtn.addEventListener('click', () => {
            isRegisterMode = !isRegisterMode;
            updateLoginUI();
        });

        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-password').value;
            const errorMsg = document.getElementById('login-error');
            errorMsg.textContent = "Processando...";

            try {
                if (isRegisterMode) {
                    const cred = await createUserWithEmailAndPassword(auth, email, pass);
                    // Create user doc
                    await setDoc(doc(db, "users", cred.user.uid), { 
                        email, 
                        createdAt: new Date(), 
                        completedPosts: [] 
                    });
                    // Force refresh to allow admin check
                    window.location.reload();
                } else {
                    await signInWithEmailAndPassword(auth, email, pass);
                }
            } catch (err) {
                console.error(err);
                let msg = "Erro ao acessar.";
                if (err.code === 'auth/weak-password') msg = "Senha muito fraca.";
                if (err.code === 'auth/email-already-in-use') msg = "Email j√° cadastrado.";
                if (err.code === 'auth/invalid-credential') msg = "Email ou senha incorretos.";
                errorMsg.textContent = msg;
            }
        });

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                userInfo.style.display = 'flex';
                loginBtn.style.display = 'none';
                document.getElementById('header-user-name').textContent = user.email.split('@')[0];
                document.getElementById('profile-email-display').textContent = user.email;
                document.getElementById('comment-form-container').classList.remove('hidden');

                // üö® ALERTA DE UID PARA O ADMIN üö®
                console.log("--------------------------------------------------");
                console.log("SEU UID √â: ", user.uid);
                console.log("COPIE E COLE NO C√ìDIGO HTML NA CONSTANTE ADMIN_UID");
                console.log("--------------------------------------------------");

                if (user.uid === ADMIN_UID) {
                    // √â ADMIN
                    adminPanel.style.display = 'block'; 
                    document.querySelectorAll('.admin-only-controls').forEach(e => e.classList.remove('hidden'));
                    document.getElementById('profile-admin-badge').classList.remove('hidden');
                    fetchStudents(); // BUSCA ALUNOS APENAS SE FOR ADMIN
                } else {
                    // N√ÉO √â ADMIN
                    adminPanel.style.display = 'none';
                    document.querySelectorAll('.admin-only-controls').forEach(e => e.classList.add('hidden'));
                    document.getElementById('profile-admin-badge').classList.add('hidden');
                }

                // Load User Data
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if(userDoc.exists()) {
                    const d = userDoc.data();
                    completedPosts = d.completedPosts || [];
                }
                
                if(document.getElementById('login-view').style.display === 'flex') showView('blog-view');
            } else {
                currentUser = null;
                userInfo.style.display = 'none';
                loginBtn.style.display = 'block';
                adminPanel.style.display = 'none';
                document.querySelectorAll('.admin-only-controls').forEach(e => e.classList.add('hidden'));
                document.getElementById('comment-form-container').classList.add('hidden');
                if(studentsUnsubscribe) studentsUnsubscribe(); // Para de ouvir se deslogar
            }
            fetchSections();
            fetchPosts();
        });

        document.getElementById('login-btn').addEventListener('click', () => showView('login-view'));
        document.getElementById('close-login-btn').addEventListener('click', () => showView('home-view'));
        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));

        // === SECTIONS & POSTS DATA ===
        function fetchSections() {
            onSnapshot(query(collection(db, "sections"), orderBy("name")), (snap) => {
                allSections = [];
                const select = document.getElementById('post-section');
                const container = document.getElementById('sections-cards-container');
                const listAdmin = document.getElementById('sections-list-admin');
                
                select.innerHTML = '<option value="">Selecione a Trilha</option>';
                container.innerHTML = '';
                listAdmin.innerHTML = '';

                snap.forEach(d => {
                    const s = { id: d.id, ...d.data() };
                    allSections.push(s);
                    select.add(new Option(s.name, s.id));
                    listAdmin.innerHTML += `<div class="flex justify-between p-2 border-b border-white/5">${s.name} <button onclick="deleteSection('${s.id}')" class="text-red-500"><i class="fas fa-times"></i></button></div>`;
                    
                    const card = document.createElement('div');
                    card.className = "project-card bg-obsidian border border-white/5 p-8 relative group cursor-pointer flex flex-col items-center justify-center text-center min-h-[250px] shadow-2xl";
                    card.onclick = () => openPath(s.id, s.name);
                    card.innerHTML = `
                        <div class="absolute inset-0 bg-gradient-to-t from-primary-900/20 to-transparent opacity-0 group-hover:opacity-100 transition duration-500"></div>
                        <i class="fas fa-play-circle text-5xl text-gray-700 mb-6 group-hover:text-primary-400 transition transform group-hover:scale-110"></i>
                        <h4 class="text-xl font-display text-white mb-2 group-hover:text-primary-400 transition">${s.name}</h4>
                        <p class="text-[10px] text-gray-500 uppercase tracking-widest">Iniciar Aulas</p>
                    `;
                    container.appendChild(card);
                });
            });
        }

        function fetchPosts() {
            onSnapshot(query(collection(db, "posts"), orderBy("createdAt", "asc")), (snap) => {
                allPosts = [];
                snap.forEach(d => allPosts.push({ id: d.id, ...d.data() }));
                if(activeSectionId) renderPath(activeSectionId);
            });
        }

        // === STUDENT MANAGEMENT (LIST & CREATE) ===
        function fetchStudents() {
            const listContainer = document.getElementById('students-list-container');
            const countBadge = document.getElementById('student-count');
            
            if(studentsUnsubscribe) studentsUnsubscribe();

            studentsUnsubscribe = onSnapshot(query(collection(db, "users")), (snap) => {
                listContainer.innerHTML = '';
                let count = 0;
                
                snap.forEach(d => {
                    if (d.id === ADMIN_UID) return; // N√£o mostra o admin na lista
                    
                    count++;
                    const user = d.data();
                    const email = user.email || "Email Oculto";
                    const joined = user.createdAt ? new Date(user.createdAt.toDate()).toLocaleDateString() : "Data N/A";

                    const row = document.createElement('div');
                    row.className = "flex justify-between items-center p-3 bg-white/5 border border-white/5 rounded hover:bg-white/10 transition";
                    row.innerHTML = `
                        <div class="overflow-hidden">
                            <p class="text-xs text-gray-200 truncate" title="${email}">${email}</p>
                            <p class="text-[9px] text-gray-600 uppercase tracking-wide">Entrou em: ${joined}</p>
                        </div>
                        <button onclick="deleteStudent('${d.id}')" class="text-red-900 hover:text-red-500 transition px-2" title="Remover Aluno">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    listContainer.appendChild(row);
                });

                countBadge.textContent = count;
                if (count === 0) {
                    listContainer.innerHTML = '<p class="text-center text-gray-600 text-xs italic py-4">O grim√≥rio est√° vazio. Adicione iniciados.</p>';
                }
            });
        }

        // CREATE STUDENT WITHOUT LOGGING OUT ADMIN
        document.getElementById('create-account-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('new-email').value;
            const pass = document.getElementById('new-password').value;
            const status = document.getElementById('account-status');
            const btn = document.getElementById('create-student-btn');

            status.textContent = "Invocando acesso...";
            status.className = "text-xs h-4 text-center text-primary-400";
            btn.disabled = true;

            try {
                // 1. Inicializa uma App Secund√°ria para n√£o deslogar o admin
                const secondaryApp = initializeApp(firebaseConfig, "SecondaryApp");
                const secondaryAuth = getAuth(secondaryApp);

                // 2. Cria o usu√°rio na Auth do Firebase
                const userCred = await createUserWithEmailAndPassword(secondaryAuth, email, pass);
                
                // 3. Salva os dados no Firestore (usando o DB principal)
                await setDoc(doc(db, "users", userCred.user.uid), {
                    email: email,
                    createdAt: new Date(),
                    completedPosts: [],
                    role: 'student'
                });

                // 4. Limpa a app secund√°ria
                await signOut(secondaryAuth);
                await deleteApp(secondaryApp);

                status.textContent = "Aluno Iniciado com Sucesso!";
                status.className = "text-xs h-4 text-center text-green-400";
                document.getElementById('create-account-form').reset();
            } catch (err) {
                console.error(err);
                let msg = "Falha no ritual.";
                if (err.code === 'auth/email-already-in-use') msg = "Este email j√° √© um iniciado.";
                if (err.code === 'auth/weak-password') msg = "A senha deve ter 6+ caracteres.";
                status.textContent = msg;
                status.className = "text-xs h-4 text-center text-red-400";
            }
            btn.disabled = false;
        });

        // DELETE STUDENT
        window.deleteStudent = async (uid) => {
            if(confirm("Tem certeza que deseja banir este iniciado? O acesso ser√° revogado permanentemente (a conta Auth precisa ser desativada manualmente no console Firebase, mas o acesso ao app ser√° removido).")) {
                try {
                    await deleteDoc(doc(db, "users", uid));
                    // Nota: Deletar doc n√£o deleta Auth user no client-side por seguran√ßa. 
                    // Mas sem doc, o app pode bloquear acesso se implementarmos verifica√ß√£o de doc.
                    alert("Registro apagado do Grim√≥rio.");
                } catch(e) {
                    console.error(e);
                    alert("Erro ao apagar registro.");
                }
            }
        };

        document.getElementById('create-section-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const n = document.getElementById('section-name').value;
            if(n) { await addDoc(collection(db, "sections"), { name: n, createdAt: new Date() }); e.target.reset(); }
        });

        window.deleteSection = async (id) => { if(confirm("Apagar trilha?")) await deleteDoc(doc(db, "sections", id)); };

        document.getElementById('create-post-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const status = document.getElementById('post-status');
            status.textContent = "Salvando...";
            const secSelect = document.getElementById('post-section');
            try {
                await addDoc(collection(db, "posts"), {
                    title: document.getElementById('post-title').value,
                    subtitle: document.getElementById('post-subtitle').value,
                    videoURL: document.getElementById('post-video-link').value,
                    pdfURL: document.getElementById('post-pdf-link').value,
                    content: document.getElementById('post-content').value,
                    access: document.getElementById('post-access').value,
                    sectionId: secSelect.value,
                    createdAt: new Date()
                });
                status.textContent = "Aula Publicada!";
                e.target.reset();
            } catch(err) { console.error(err); status.textContent = "Erro ao salvar."; }
        });

        function openPath(id, name) {
            activeSectionId = id;
            document.getElementById('path-title').textContent = name;
            document.getElementById('sections-hub').classList.add('hidden');
            document.getElementById('active-path-view').classList.remove('hidden');
            renderPath(id);
        }

        document.getElementById('back-to-hub-btn').addEventListener('click', () => {
            activeSectionId = null;
            document.getElementById('active-path-view').classList.add('hidden');
            document.getElementById('sections-hub').classList.remove('hidden');
        });

        function renderPath(sectionId) {
            const container = document.getElementById('path-steps-container');
            container.innerHTML = '';
            const posts = allPosts.filter(p => p.sectionId === sectionId);
            if(posts.length === 0) {
                document.getElementById('empty-path-msg').classList.remove('hidden');
                return;
            }
            document.getElementById('empty-path-msg').classList.add('hidden');

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("class", "path-svg-line");
            const spacing = 180;
            const totalHeight = (posts.length * spacing) + 200;
            container.style.height = totalHeight + 'px';
            svg.style.height = totalHeight + 'px';
            container.appendChild(svg);

            let pathD = "";
            let prevX = container.offsetWidth / 2;
            let prevY = 50;
            const centerX = container.offsetWidth / 2;

            posts.forEach((p, i) => {
                const isCompleted = completedPosts.includes(p.id);
                // Admin v√™ tudo liberado, mas a l√≥gica de 'completed' mant√©m o progresso pessoal
                const isAdmin = currentUser && currentUser.uid === ADMIN_UID;
                const isLocked = (!currentUser) ? false : (i > 0 && !completedPosts.includes(posts[i-1].id) && !isAdmin);
                
                const y = 50 + (i * spacing);
                const x = centerX + Math.sin(i * 1.5) * (window.innerWidth < 768 ? 60 : 120);

                if (i === 0) pathD += `M ${x} ${y}`;
                else pathD += ` Q ${prevX} ${(prevY + y) / 2}, ${x} ${y}`;
                prevX = x; prevY = y;

                const node = document.createElement('div');
                node.className = "path-node-wrapper";
                node.style.left = x + 'px';
                node.style.top = y + 'px';
                
                let statusClass = isLocked ? 'status-locked' : (isCompleted ? 'status-completed' : 'status-active');
                let icon = isLocked ? 'fa-lock' : (isCompleted ? 'fa-check' : 'fa-play');
                const clickFn = isLocked ? "alert('Complete a aula anterior para desbloquear.')" : `openClass('${p.id}')`;

                node.innerHTML = `
                    <div class="game-node ${statusClass}" onclick="${clickFn}">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="node-label">${p.title}</div>
                `;
                container.appendChild(node);
            });

            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("d", pathD);
            path.setAttribute("stroke", "#333");
            path.setAttribute("stroke-width", "8");
            path.setAttribute("fill", "none");
            svg.appendChild(path);
        }

        window.openClass = function(id) { openPost(id); }

        function getDriveEmbedLink(url) {
            if (!url) return '';
            if (url.includes('drive.google.com')) {
                return url.replace(/\/view.*/, '/preview').replace(/\/edit.*/, '/preview');
            }
            return url;
        }

        async function openPost(id) {
            loadingSpinner.classList.remove('hidden');
            const snap = await getDoc(doc(db, "posts", id));
            if(snap.exists()) {
                const p = snap.data();
                currentPostId = id;
                document.getElementById('post-view-title').textContent = p.title;
                document.getElementById('post-view-subtitle').textContent = p.subtitle || '';
                document.getElementById('post-view-content').textContent = p.content || '';
                document.getElementById('video-iframe').src = getDriveEmbedLink(p.videoURL);
                const pdfBtn = document.getElementById('post-view-pdf-btn');
                if(p.pdfURL) {
                    pdfBtn.href = p.pdfURL;
                    pdfBtn.classList.remove('hidden');
                } else {
                    pdfBtn.classList.add('hidden');
                }
                const compBtn = document.getElementById('mark-complete-btn');
                if(completedPosts.includes(id)) {
                    compBtn.className = "bg-green-900/30 text-green-400 border border-green-500/50 px-10 py-3 rounded-full text-xs font-bold uppercase tracking-widest cursor-default flex items-center gap-2";
                    compBtn.innerHTML = '<i class="fas fa-check-double"></i> Aula Conclu√≠da';
                    compBtn.onclick = null;
                } else {
                    compBtn.className = "bg-transparent border border-primary-500 text-primary-400 hover:bg-primary-500 hover:text-black px-10 py-3 rounded-full font-display font-bold uppercase tracking-widest text-xs transition transform hover:scale-105 flex items-center gap-3 cursor-pointer";
                    compBtn.innerHTML = '<i class="fas fa-check-circle text-lg"></i> Marcar Aula como Conclu√≠da';
                    compBtn.onclick = markComplete;
                }
                
                document.getElementById('post-view-delete-btn').onclick = async () => {
                    if(confirm("Excluir esta aula?")) {
                        await deleteDoc(doc(db, "posts", id));
                        showView('blog-view');
                    }
                };

                loadComments(id);
                showView('post-view');
            }
            loadingSpinner.classList.add('hidden');
        }

        document.getElementById('back-to-posts-btn').addEventListener('click', () => {
            document.getElementById('video-iframe').src = "";
            showView('blog-view');
        });

        async function markComplete() {
            if(!currentUser || !currentPostId) return alert("Fa√ßa login.");
            try {
                await updateDoc(doc(db, "users", currentUser.uid), { completedPosts: arrayUnion(currentPostId) });
                if(!completedPosts.includes(currentPostId)) completedPosts.push(currentPostId);
                openPost(currentPostId);
            } catch(e) { console.error(e); }
        }

        function loadComments(postId) {
            if(commentsUnsubscribe) commentsUnsubscribe();
            commentsUnsubscribe = onSnapshot(query(collection(db, "comments"), where("postId", "==", postId)), (snap) => {
                const list = document.getElementById('comments-list');
                list.innerHTML = '';
                if(snap.empty) { list.innerHTML = '<p class="text-gray-600 italic text-xs">Sem d√∫vidas ainda.</p>'; return; }
                let comms = [];
                snap.forEach(d => comms.push({id: d.id, ...d.data()}));
                comms.sort((a,b) => (b.createdAt?.seconds||0) - (a.createdAt?.seconds||0));
                comms.forEach(c => {
                    const div = document.createElement('div');
                    div.className = "bg-white/5 p-4 rounded border border-white/5";
                    div.innerHTML = `
                        <div class="flex justify-between mb-1">
                            <span class="text-primary-400 text-[10px] font-bold uppercase">${c.userName}</span>
                            <span class="text-gray-600 text-[9px]">${new Date(c.createdAt?.toDate()).toLocaleDateString()}</span>
                        </div>
                        <p class="text-gray-300 text-sm">${c.content}</p>
                    `;
                    list.appendChild(div);
                });
            });
        }

        document.getElementById('submit-comment-btn').addEventListener('click', async () => {
            const txt = document.getElementById('comment-input').value;
            if(!currentUser || !txt) return;
            await addDoc(collection(db, "comments"), {
                postId: currentPostId,
                userName: currentUser.email.split('@')[0],
                content: txt,
                createdAt: new Date()
            });
            document.getElementById('comment-input').value = '';
        });

    </script>
</body>
</html>
